---
title: "data viz"
author: "Maria"
date: "4/1/2021"
output: html_document
---

# Human lncRNA expression during LS Plasmodium infection
```{r}
#load libraries
library(tidyverse)
library(pheatmap)
library(RColorBrewer)
library(readr)
```

The data used below is from the S5 table form Posfai et al 2018, and has been filtered to be only lncRNAs. The list of lncRNAs was taken from Kaessmann et al 2019.
```{r}
#import data
hslncs <- read_csv("source_data/lncs_s5.csv")
```
```{r}
#diagnose data, make sure looks ok
glimpse(hslncs)
hslncs$timepoint <- as_factor(hslncs$timepoint)
hslncs$timepoint <- fct_relevel(hslncs$timepoint, "early", "mid", "late")

#remove duplicate rows
hslncsc <- hslncs %>% distinct()
glimpse(hslncsc)
```
Removing duplicate rows gotrid of ~4k rows.

## Volcano Plots

To generate a volcano plot, we first need to have a column in our results data indicating whether or not the gene is considered differentially expressed based on p-adjusted values.

```{r}
ggplot(hslncsc) +
  aes(x = log2FC, y = -log10(padj)) +
  geom_point() +
  theme_gray() +
  facet_grid(rows = vars(cell), cols = vars(timepoint))
```
This is good but I want to color the differentially expressed lncs. My threshold for log2Fc is low, ~1.4.
```{r}
# The significantly differentially expressed genes are the ones found in the upper-left and upper-right corners.
# Add a column to the data frame to specify if they are UP- or DOWN- regulated (log2FoldChange respectively positive or negative)

# add a column of NAs
hslncsc$diffexpressed <- "NO"
# if log2Foldchange > 0.5 and pvalue < 0.05, set as "UP" 
hslncsc$diffexpressed[hslncsc$log2FC > 0.5 & hslncsc$padj < 0.05] <- "UP"
# if log2Foldchange < -0.5 and pvalue < 0.05, set as "DOWN"
hslncsc$diffexpressed[hslncsc$log2FC < -0.5 & hslncsc$padj < 0.05] <- "DOWN"

```

```{r}
# Re-plot but this time color the points with "diffexpressed"
ggplot(hslncsc) +
  aes(x = log2FC, y = -log10(padj), color = diffexpressed, alpha = 0.05) +
  geom_point() +
  theme_gray() +
  facet_grid(rows = vars(cell), cols = vars(timepoint), scales = "free_y") +
  scale_color_manual(values = c("dark green","gray","purple"))

```
## Top DEG genes

```{r}
#make a new table with just DEGs
deg_gene <- filter(hslncsc, diffexpressed == "UP" | diffexpressed == "DOWN")
deg_gene <- pull(deg_gene, gene)
degs <- filter(hslncsc, gene == deg_gene)
glimpse(degs)
```
```{r}

#plot example dotplot for gene/neighbor graph
ggplot(degs) +
  aes(x = log2FC, y = reorder(gene, log2FC), color = timepoint) +
  geom_point(size = 2.5) +
  facet_grid(cols = vars(cell)) +
  ylab("lncRNA") +
  theme_gray() +
  theme(
    aspect.ratio = 3 / 1, 
    text = element_text(size = 11),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_line(colour = "gray", size = 0.25, linetype = "dashed"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank()
  )

```
# Import coding gene data
```{r}
#import s5 table from plos pathogens paper
hsgenes <- read_csv("source_data/S5_Table.csv")

#import kaessmar paper with lncRNAs and closest neighbor coding gene
closest <- read_csv("source_data/select_Kaessmann2019.csv")
```

# Make new df with lncRNA and neihgbor info
```{r}
#make df with lncRNA-Neighbor info
deg_neigh <- filter(closest, deg_gene %in% "LncRNA gene") 
```



